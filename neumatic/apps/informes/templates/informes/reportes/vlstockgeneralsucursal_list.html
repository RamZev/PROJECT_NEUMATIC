<!-- neumatic\apps\informes\templates\informes\reportes\vlstockgeneralsucursal_list.html -->

{% extends 'informes/reportes/base_reportes.html' %}
{% load static %}
{% load custom_tags %}

<!-- Blque Header -------------------------------------------------------------------------- -->
 
<!-- Contenido Inferior Izquierdo -->
{% block header_bottom_left %}
	{% for param, valor in parametros_i.items %}
		<p class="compact-line-spacing"><strong>{{ param }}:</strong> {{ valor }}</p>
	{% endfor %}
{% endblock %}

<!-- Contenido Inferior Derecho -->
{% block header_bottom_right %}
	{% for param, valor in parametros_d.items %}
		<p class="compact-line-spacing"><strong>{{ param }}:</strong> {{ valor }}</p>
	{% endfor %}
{% endblock %}

<!-- Bloque Content ------------------------------------------------------------------------ -->

{% block content %}

<style>
	/* Estilos para fijar los títulos de las columnas de la tabla (Sticky) */
	/* Contenedor para la tabla con scroll */
	.table-container {
		max-height: 80vh;
		overflow-y: auto;
		position: relative;
	}
	
	/* Fijar el encabezado */
	table thead th {
		position: sticky;
		top: 0;
		background-color: white;
		z-index: 10;
		box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1);
	}
	
	/* Asegurar que la primera columna también sea sticky si es necesario */
	table thead th:first-child {
		left: 0;
		z-index: 20;
	}
	
	/* Opcional: estilo para el encabezado */
	table thead th {
		background-color: #9c9c9cff;
		font-weight: bold;
		/* padding: 10px; */
		padding-top: 10px;
		padding-bottom: 10px;
	}
</style>
	
	<table>
		<thead>
			<tr>
				<th style="width: 20px;"></th>
				<th>Código</th>
				<th>CAI</th>
				<th>Medida</th>
				<th>Descripción</th>
				<th>Marca</th>
				{% for sucursal in sucursales_info %}
					<th class="numeric">{{sucursal.nombre}}</th>
				{% endfor %}
				<th class="numeric">Otras Suc.</th>
				<th class="numeric" style="padding-right: 10px;">Stock Total</th>
			</tr>
		</thead>
		<tbody>
			
			{% for familia_id, familia_data in objetos.items %}
				<!-- Fila con los datos de la Familia -->
				<tr>
					<td colspan="{{ sucursales_info|length|add:8 }}" style="padding-top: 5px;">
						<strong>Familia: {{ familia_data.familia }}</strong>
					</td>
				</tr>
				
				{% for modelo_id, modelo_data in familia_data.modelos.items %}
					<!-- Fila con los datos del Modelo -->
					<tr>
						<td></td>
						<td colspan="{{ sucursales_info|length|add:7 }}">
							<strong>Modelo: {{ modelo_data.modelo }}</strong>
						</td>
					</tr>
					
					<!-- Filas con el detalle del Modelo -->
					{% for det in modelo_data.detalle %}
						<tr>
							<td></td>
							<td>{{ det.id_producto_id }}</td>
							<td>{{ det.cai }}</td>
							<td>{{ det.medida }}</td>
							<td>{{ det.nombre_producto }}</td>
							<td>{{ det.nombre_producto_marca }}</td>
							{% for sucursal in sucursales_info %}
								<td class="numeric">{{ det.stocks|get_item:sucursal.nombre|default:0|formato_es_ar_entero }}</td>
							{% endfor %}
							<td class="numeric">{{ det.otras_suc|default:0|formato_es_ar_entero }}</td>
							<td class="numeric" style="padding-right: 10px;">{{ det.stock_total|default:0|formato_es_ar_entero }}</td>							
						</tr>
					{% endfor %}
					
					<!-- Sub-Totales por Modelo -->
					<tr>
						<td class="numeric" colspan="6"><strong>Total Modelo:</strong></td>
						{% for sucursal in sucursales_info %}
							<td class="numeric"><strong>{{ modelo_data.stm|get_item:sucursal.nombre|default:0|formato_es_ar_entero }}</strong></td>
						{% endfor %}
						<td class="numeric"><strong>{{ modelo_data.stm.otras_suc|default:0|formato_es_ar_entero }}</strong></td>
						<td class="numeric" style="padding-right: 10px;"><strong>{{ modelo_data.stm.stock_total|default:0|formato_es_ar_entero }}</strong></td>						
					</tr>
				
				{% endfor %}
				
				<!-- Sub-Totales por Familia -->
				<tr>
					<td class="numeric" colspan="6"><strong>Total Familia:</strong></td>
					{% for sucursal in sucursales_info %}
						<td class="numeric"><strong>{{ familia_data.stf|get_item:sucursal.nombre|default:0|formato_es_ar_entero }}</strong></td>
					{% endfor %}
					<td class="numeric"><strong>{{ familia_data.stf.otras_suc|default:0|formato_es_ar_entero }}</strong></td>
					<td class="numeric" style="padding-right: 10px;"><strong>{{ familia_data.stf.stock_total|default:0|formato_es_ar_entero }}</strong></td>
				</tr>
				
				<tr>
					<td colspan="{{ sucursales_info|length|add:8 }}"><hr></td>
				</tr>
			
			{% endfor %}
			
			<!-- Totales Generales -->
			<tr>
				<td class="numeric" colspan="6"><strong>Total General:</strong></td>
				{% for sucursal in sucursales_info %}
					<td class="numeric"><strong>{{ total_general|get_item:sucursal.nombre|default:0|formato_es_ar_entero }}</strong></td>
				{% endfor %}
				<td class="numeric"><strong>{{ total_general.otras_suc|default:0|formato_es_ar_entero }}</strong></td>
				<td class="numeric" style="padding-right: 10px;"><strong>{{ total_general.stock_total|default:0|formato_es_ar_entero }}</strong></td>
			</tr>
			
		</tbody>
		
	</table>
{% endblock content %}